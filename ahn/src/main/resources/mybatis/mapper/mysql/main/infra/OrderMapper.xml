<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.a5a5lab.module.order.OrderDao">

	<resultMap id="resultMapObj"
		type="com.a5a5lab.module.order.OrderDto"></resultMap>





	<!-- 주문내역 리스트 -->
	<select id="selectList" resultMap="resultMapObj">
		select
		a.orderSeq,
		a.orderTypeCd,
		c.memName,
		c.memId,
		c.memAddress,
		a.regDateTime,
		a.deliveryStatus,
		a.paymentStatus
		from
		`order` AS a
		left join member AS c ON a.member_memSeq= c.memSeq
		WHERE 1=1
		AND
		orderTypeCd=20
		order By orderSeq DESC

		LIMIT #{rowNumToShow} OFFSET #{startRnumForMysql}
	</select>

	<!-- 주문카운트 -->
	<select id="selectOneCount" resultType="Integer">
		SELECT COUNT(*)
		FROM
		`order`
		WHERE 1=1
		AND orderTypeCd = 20
	</select>
	<!-- 주문상세상품카운트 -->
	<select id="selectOneOrderDetailCount" resultType="Integer">
		SELECT
		COUNT(*)
		FROM
		order_detail
		WHERE 1=1
		AND order_orderSeq = #{orderSeq}
	</select>
	<!-- 상품카운트 -->
	<select id="selectOneProductCount" resultType="Integer">
		SELECT COUNT(*)
		FROM
		shoes
	</select>
	<!-- 발주 카운트 -->
	<select id="selectOneOrderingCount" resultType="Integer">
		SELECT COUNT(*)
		FROM
		`order`
		WHERE 1=1
		AND orderTypeCd = 21
	</select>

	<!-- 주문상세페이지 -->
	<!--한개의 주문번호 불러오기 -->
	<select id="selectOne" resultMap="resultMapObj">
		select
		a.orderSeq,
		c.memName,
		c.memId,
		c.memAddress,
		c.memTel,
		a.regDateTime,
		a.deliveryStatus,
		a.paymentStatus
		from
		`order` AS a
		left join member AS c ON a.member_memSeq= c.memSeq
		WHERE
		a.orderSeq= #{orderSeq}
	</select>
	<!--불러온 주문번호의 상세목록 -->
	<select id="orderDetailList" resultMap="resultMapObj">
		select
		b.orderDetailSeq,
		a.shBrandCd,
		a.shTypeCd,
		a.shSeq,
		a.shName,
		a.shSizeCd,
		b.shOrderCount,
		a.shCount,
		a.shPrice * b.shOrderCount AS sumPrice,
		c.orderSeq
		FROM
		shoes AS a
		left join order_detail AS b ON a.shSeq = b.shoes_shSeq
		left join
		`order` AS c ON c.orderSeq = b.order_orderSeq
		where
		order_orderSeq = #{orderSeq}
	</select>



	<!-- 창고재고관리 -->
	<select id="storageList" resultMap="resultMapObj">
		select
		shSeq,
		shName,
		shSizeCd,
		shBrandCd,
		shTypeCd,
		salesStatus,
		regDateTime,
		modDateTime,
		shDelNy,
		shCount,
		shPrice
		FROM
		shoes
		WHERE 1=1
		ORDER BY shSeq DESC
		LIMIT #{rowNumToShow} OFFSET
		#{startRnumForMysql}
	</select>

	<!-- 발주 내역 리스트 -->
	<select id="FactoryOrderList" resultMap="resultMapObj">
		SELECT
		s.shSeq,
		s.shName,
		s.shSizeCd,
		s.shBrandCd,
		s.shTypeCd,
		cb.ifcdName AS brandName,
		cs.ifcdName AS sizeName,
		ct.ifcdName AS typeName,
		cot.ifcdName AS orderTypeName,
		od.shOrderCount,
		s.shPrice,
		o.regDateTime,
		m.memName
		FROM `order` o
		JOIN order_detail od ON o.orderSeq = od.order_orderSeq
		JOIN shoes s ON od.shoes_shSeq = s.shSeq
		JOIN member m ON
		o.member_memSeq = m.memSeq
		LEFT JOIN code cb ON s.shBrandCd = cb.cdSeq
		LEFT JOIN code cs ON s.shSizeCd = cs.cdSeq
		LEFT JOIN code ct ON
		s.shTypeCd = ct.cdSeq
		LEFT JOIN code cot ON o.orderTypeCd = cot.cdSeq
		WHERE o.orderDelNy = 0
		AND o.orderTypeCd = 21
		LIMIT #{rowNumToShow} OFFSET #{startRnumForMysql}
	</select>






</mapper>