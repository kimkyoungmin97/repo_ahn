<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<div th:replace="~{xdm/include/head :: head}"></div>

<form  method="post" id="form">
<input type="hidden" id="shSeq" name="shSeq">
	<!-- ### -->

	<section class="content">
		<div class="container-fluid">

			<div class="block-header">
				<h2>발주</h2>
			</div>

			<!-- Input -->
			<div class="row clearfix">
				<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
					<div class="card">
						<div class="header">
							<h2>발주</h2>
							<ul class="header-dropdown m-r--5">
								<li class="dropdown"><a href="javascript:void(0);"
									class="dropdown-toggle" data-toggle="dropdown" role="button"
									aria-haspopup="true" aria-expanded="false"> <i
										class="material-icons">more_vert</i>
								</a>
									<ul class="dropdown-menu pull-right">
										<li><a href="javascript:void(0);">Action</a></li>
										<li><a href="javascript:void(0);">Another action</a></li>
										<li><a href="javascript:void(0);">Something else here</a></li>
									</ul></li>
							</ul>
						</div>
						<div class="body">
							<h2 class="card-inside-title">
								<small>주문자<span style="color: red;">*</span></small>
							</h2>
							<div class="row clearfix">
								<div class="col-sm-12">
									<div class="row clearfix">
										<div class="col-sm-3">
											<select class="form-control show-tick" id="memSeq" name="memSeq"     >
												<option value="">선택하세요</option>
												<option th:each="list : ${list}" th:text="${list.memName}" th:value="${list?.memSeq}" ></option>
											</select> <div id="memNameError"
												style="color: red; font-size: 10px;"></div>
										</div>
									</div>
								</div>
								<div class="col-sm-3">
									<div class="form-group">
										<div class="form-line">
											<h2 class="card-inside-title">
												<small>주문자ID</small>
											</h2>
											<div  name="memId" id="memId">&nbsp;</div>
										</div>
									</div>
								</div>
								<div class="col-sm-3">
									<div class="form-group">
										<div class="form-line">
											<h2 class="card-inside-title">
												<small>배송주소</small>
											</h2>
											<div  name="memAddress" id="memAddress">&nbsp;</div>
										</div>
									</div>
								</div>
							</div>
							<div class="row clearfix">
								<div class="col-sm-12">
									<div class="row clearfix">
										<div class="col-sm-3">
										<small style="font-size: 11px; color: #999; display: block; margin-top: 5px;">신발<span style="color: red;">*</span></small>
											<select class="form-control show-tick" id="shName" name="shName"  >
												<option value="">선택하세요</option>
												<option th:each="list : ${shoes}" th:text="${list.shName}" th:value="${list.shName}"></option>
											</select> <div id="shNameError"
												style="color: red; font-size: 10px;"></div>
										</div>
										<div class="col-sm-3">
										<small style="font-size: 11px; color: #999; display: block; margin-top: 5px;">사이즈<span style="color: red;">*</span></small>
											<select class="form-control show-tick" id="shSizeCd" name="shSizeCd" disabled>
												<option value="">선택하세요</option>
											</select> <div id="shSizeCdError"
												style="color: red; font-size: 10px;"></div>
										</div>
									</div>
								</div>
								 <div class="col-sm-3">
									<div class="form-group">
										<div class="form-line">
											<h2 class="card-inside-title">
												<small>수량</small>
											</h2>
											<input type="text" id="shOrderCount" name="shOrderCount" class="form-control">
											<div id="shOrderCountError" style="color: red; font-size: 10px;"></div>
										</div>
									</div>
								</div> 
								 
							</div>
							<div class="row clearfix">
								<div class="col-sm-12">
									<div class="row clearfix">
										<!-- <div class="col-sm-3">
											<h2 class="card-inside-title">
												<small>사용여부</small>
											</h2>
											<select class="form-control show-tick ">
												<option value="">사용</option>

											</select>
										</div>
										<div class="col-sm-3">
											<div class="form-group">
												<div class="form-line">
													<h2 class="card-inside-title">
														<small>순서</small>
													</h2>
													<input type="text" class="form-control" placeholder="" />
												</div>
											</div>
										</div> -->

									</div>
									<div class="col-sm-12">
										<!-- <div class="form-group">
											<div class="form-line">
												<h2 class="card-inside-title">
													<small>설명</small>
												</h2>
												<textarea rows="4" class="form-control no-resize"
													placeholder=""></textarea>
											</div>
										</div> -->
										<a role="button" class="btn btn-light" style="float: left;"
											th:href="@{/FactoryOrderXdmList}"> <svg
												xmlns="http://www.w3.org/2000/svg" width="16" height="16"
												fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                                                <path
													fill-rule="evenodd"
													d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5" />
                                            </svg>
										</a>
										     &nbsp; &nbsp;
                                        <!-- 업데이트 삭제 -->
                                       <button type="button" class="btn btn-danger" id="btnUelete">
	                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
	                                        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
	                                        <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
	                                      </svg>
	                                    </button>
										<button type="button" class="btn btn-primary"
											style="float: right;" id="btnSubmit" data-toggle="modal">
											<svg xmlns="http://www.w3.org/2000/svg" width="16"
												height="16" fill="currentColor" class="bi bi-database"
												viewBox="0 0 16 16">
                                                <path
													d="M4.318 2.687C5.234 2.271 6.536 2 8 2s2.766.27 3.682.687C12.644 3.125 13 3.627 13 4c0 .374-.356.875-1.318 1.313C10.766 5.729 9.464 6 8 6s-2.766-.27-3.682-.687C3.356 4.875 3 4.373 3 4c0-.374.356-.875 1.318-1.313M13 5.698V7c0 .374-.356.875-1.318 1.313C10.766 8.729 9.464 9 8 9s-2.766-.27-3.682-.687C3.356 7.875 3 7.373 3 7V5.698c.271.202.58.378.904.525C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777A5 5 0 0 0 13 5.698M14 4c0-1.007-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1s-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4v9c0 1.007.875 1.755 1.904 2.223C4.978 15.71 6.427 16 8 16s3.022-.289 4.096-.777C13.125 14.755 14 14.007 14 13zm-1 4.698V10c0 .374-.356.875-1.318 1.313C10.766 11.729 9.464 12 8 12s-2.766-.27-3.682-.687C3.356 10.875 3 10.373 3 10V8.698c.271.202.58.378.904.525C4.978 9.71 6.427 10 8 10s3.022-.289 4.096-.777A5 5 0 0 0 13 8.698m0 3V13c0 .374-.356.875-1.318 1.313C10.766 14.729 9.464 15 8 15s-2.766-.27-3.682-.687C3.356 13.875 3 13.373 3 13v-1.302c.271.202.58.378.904.525C4.978 12.71 6.427 13 8 13s3.022-.289 4.096-.777c.324-.147.633-.323.904-.525" />
                                              </svg>
										</button>

									</div>
									
									<!-- 삭제 모달 -->
											<div class="modal fade" id="modalConfirm" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
												<div class="modal-dialog modal-dialog-centered">
													<div class="modal-content">
														<div class="modal-header">
															<h5 class="modal-title" id="modalConfirmTitle">title</h5>
															<!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">??</button> -->
														</div>
														<div class="modal-body" id="modalConfirmBody">
															body
														</div>
														<div class="modal-footer">
															<!-- <button type="button" class="btn btn-outline-secondary btn-sm btn_custom" data-bs-dismiss="modal"></button> -->
															<!-- <button type="button" class="btn btn-danger btn-sm btn_custom" name="" id="btnModalDelete">영구삭제</button> -->
															<button type="button" class="btn btn-sm btn_custom" name="" id="" href="#">닫기</button>
															<button type="button" class="btn btn-danger btn-sm btn_custom" name="" id="btnModalUelete">삭제</button>
														</div>
													</div>
												</div>
											</div>
											
										<!-- 삭제모달 AND -->
									
									
									
									
									
								</div>

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
</form>

<!-- Jquery Core Js -->
<script src="/xdm/template/master/plugins/jquery/jquery.min.js"></script>

<!-- Bootstrap Core Js -->
<script src="/xdm/template/master/plugins/bootstrap/js/bootstrap.js"></script>

<!-- Select Plugin Js -->
<script
	src="/xdm/template/master/plugins/bootstrap-select/js/bootstrap-select.js"></script>

<!-- Slimscroll Plugin Js -->
<script
	src="/xdm/template/master/plugins/jquery-slimscroll/jquery.slimscroll.js"></script>

<!-- Waves Effect Plugin Js -->
<script src="/xdm/template/master./plugins/node-waves/waves.js"></script>

<!-- Autosize Plugin Js -->
<script src="/xdm/template/master/plugins/autosize/autosize.js"></script>

<!-- Moment Plugin Js -->
<script src="/xdm/template/master/plugins/momentjs/moment.js"></script>

<!-- Bootstrap Material Datetime Picker Plugin Js -->
<script
	src="/xdm/template/master/plugins/bootstrap-material-datetimepicker/js/bootstrap-material-datetimepicker.js"></script>

<!-- Bootstrap Datepicker Plugin Js -->
<script
	src="/xdm/template/master/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>

<!-- Custom Js -->
<script src="/xdm/template/master/js/admin.js"></script>
<script src="/xdm/template/master/js/pages/forms/basic-form-elements.js"></script>

<!-- Demo Js -->
<script src="/xdm/template/master/js/demo.js"></script>

<script type="text/javascript">
    // ===== 벨리데이션 함수들 =====
    function validateMemSeq() {
        let memSeq = document.getElementById("memSeq");
        let memNameError = document.getElementById("memNameError");

        if (memSeq.value.trim() === "") {
            memNameError.innerText = "주문자를 선택하세요";
            memSeq.classList.add("is-invalid");
            memSeq.classList.remove("is-valid");
            return false;
        } else {
            memNameError.innerText = "";
            memSeq.classList.remove("is-invalid");
            memSeq.classList.add("is-valid");
            return true;
        }
    }

    function validateShName() {
        let shName = document.getElementById("shName");
        let shNameError = document.getElementById("shNameError");

        if (shName.value.trim() === "") {
            shNameError.innerText = "신발을 선택하세요";
            shName.classList.add("is-invalid");
            shName.classList.remove("is-valid");
            return false;
        } else {
            shNameError.innerText = "";
            shName.classList.remove("is-invalid");
            shName.classList.add("is-valid");
            return true;
        }
    }

    function validateShSizeCd() {
        let shSizeCd = document.getElementById("shSizeCd");
        let shSizeCdError = document.getElementById("shSizeCdError");

        if (shSizeCd.value.trim() === "") {
            shSizeCdError.innerText = "사이즈를 선택하세요";
            shSizeCd.classList.add("is-invalid");
            shSizeCd.classList.remove("is-valid");
            return false;
        } else {
            shSizeCdError.innerText = "";
            shSizeCd.classList.remove("is-invalid");
            shSizeCd.classList.add("is-valid");
            return true;
        }
    }

    function validateShOrderCount() {
        let shOrderCount = document.getElementById("shOrderCount");
        let shOrderCountError = document.getElementById("shOrderCountError");
        let value = shOrderCount.value.trim();

        if (value === "") {
            shOrderCountError.innerText = "수량을 입력하세요";
            shOrderCount.classList.add("is-invalid");
            shOrderCount.classList.remove("is-valid");
            return false;
        } else if (!/^\d+$/.test(value) || parseInt(value) <= 0) {
            shOrderCountError.innerText = "수량은 1개 이상 숫자로 입력하세요";
            shOrderCount.classList.add("is-invalid");
            shOrderCount.classList.remove("is-valid");
            return false;
        } else {
            shOrderCountError.innerText = "";
            shOrderCount.classList.remove("is-invalid");
            shOrderCount.classList.add("is-valid");
            return true;
        }
    }

    // ===== AJAX 처리 =====

    // 주문자 선택 시 정보 자동 채움
    $('#memSeq').on('change', function () {
        validateMemSeq(); // 주문자 벨리데이션 실행

        let memSeq = $("#memSeq").val();
        if (memSeq) {
            $.ajax({
                async: true,
                cache: false,
                type: "POST",
                url: "/selectOneMemberProc",
                data: { "memSeq": memSeq },
                success: function(response) {
                    $('#memId').val(response.memId);
                    $('#memAddress').val(response.memAddress);
                    $('#memId').text(response.memId); // (optional) memId 텍스트로 표시
                    $('#memAddress').text(response.memAddress); // (optional) memAddress 텍스트로 표시
                },
                error: function() {
                    alert('주문자 정보를 불러오는 데 실패했습니다.');
                }
            });
        }
    });

    // 신발 선택 시 사이즈 리스트 로딩
    $('#shName').on('change', function () {
        validateShName();
        let selectedshName = $(this).val();

        if (selectedshName !== "") {
            $.ajax({
                type: "POST",
                url: "/selectOneShoesSizeProc",
                data: { shName: selectedshName },
                success: function (response) {
                    $('#shSizeCd').empty().append('<option value="">선택하세요</option>').prop('disabled', false);
                    response.sizeList.forEach(function (item) {
                        let sizeText = {
                            8: "230", 9: "240", 10: "250", 11: "260", 12: "270", 13: "280"
                        }[item.shSizeCd] || item.shSizeCd;

                        $('#shSizeCd').append(`<option value="${item.shSizeCd}">${sizeText}</option>`);
                    });
                    $('#shSizeCd').selectpicker('refresh');
                },
                error: function() {
                    alert('신발 사이즈 정보를 불러오는 데 실패했습니다.');
                }
            });
        } else {
            $('#shSizeCd').empty().append('<option value="">선택하세요</option>').prop('disabled', true).selectpicker('refresh');
        }
    });

    // 사이즈 선택 시 shSeq 설정
    $('#shSizeCd').on('change', function () {
        validateShSizeCd();
        if ($('#shName').val() && $('#shSizeCd').val()) {
            $.ajax({
                type: "POST",
                url: "/selectOneShoesProc",
                data: {
                    shName: $('#shName').val(),
                    shSizeCd: $('#shSizeCd').val()
                },
                success: function (response) {
                    $("#shSeq").val(response.shSeq);
                },
                error: function() {
                    alert('신발 정보 불러오는 데 실패했습니다.');
                }
            });
        }
    });

    // ===== 폼 제출 =====
    document.getElementById("btnSubmit").onclick = function (e) {
        e.preventDefault(); // 기본 제출 방지

        let isValid =
            validateMemSeq() &&
            validateShName() &&
            validateShSizeCd() &&
            validateShOrderCount();

        if (isValid) {
            let form = document.getElementById("form");
            form.action = "/OrderXdmInst1";
            form.submit();
        }
    };
</script>









</body>
</html>
